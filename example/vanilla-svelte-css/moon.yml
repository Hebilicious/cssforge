$schema: "https://moonrepo.dev/schemas/project.json"

language: "typescript"
layer: "application"

dependsOn:
  - "cssforge"

tasks:
  build:
    command: "vite"
    args: ["build"]
    deps:
      - "^:build"
    options:
      runInCI: false
  dev:
    command: "vite"
    deps:
      - "^:build"
    preset: "server"
    options:
      runInCI: false
  dev-e2e:
    command: "vite"
    args: ["--host", "127.0.0.1", "--port", "4179"]
    deps:
      - "^:build"
    preset: "server"
    options:
      runInCI: false
  preview:
    command: "vite"
    args: ["preview"]
    deps:
      - "~:build"
    preset: "server"
    options:
      runInCI: false
  check:
    script: "svelte-check --tsconfig ./tsconfig.app.json && tsc -p tsconfig.node.json"
    options:
      runInCI: false
  cssforge-generate:
    command: "tsx"
    args:
      - "../../packages/cssforge/src/cli.ts"
      - "--prefix"
      - "."
      - "--config"
      - "./cssforge.config.ts"
      - "--mode"
      - "css"
      - "--css"
      - "./.cssforge/output.css"
    deps:
      - "^:build"
    options:
      runInCI: false
  e2e:
    command: "playwright"
    args: ["test"]
    deps:
      - "~:cssforge-generate"
    options:
      runInCI: false
  e2e-headed:
    command: "playwright"
    args: ["test", "--headed"]
    deps:
      - "~:cssforge-generate"
    options:
      runInCI: false
  cssforge-build-local:
    command: "moon"
    args: ["run", "cssforge:jsr-dry-run"]
    options:
      runInCI: false
